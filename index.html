<html>
  <body>
    <svg id="image" xmlns="http://www.w3.org/2000/svg" version="1.1" width="221mm" height="331mm" viewBox="-0.5 -0.5 221 331">
      <rect x="0" y="0" width="220" height="330" fill="gray" />
      <g id="decades">
        <g transform="translate(0, 60)">
          <rect x='0' y='0' width='60' height='30' style='stroke:lightgray;fill:none;stroke-width:1' />
          <text x='30' y='15' text-anchor='middle' alignment-baseline='central'>1990</text>
        </g>
      </g>
      <g id="figures" transform="translate(60, 0)">
       <g id="bar2" transform="translate(90, 21)">
         <g transform="translate(15, -142.5) rotate(90) translate(142.5, -15)">
           <rect x="0" y="0" width="285" height="30" style="stroke:black;fill:#66CCFF;stroke-width:1" />
           <text x="142.5" y="15" text-anchor="middle" alignment-baseline="central">Nelson Mandela</text>
         </g>
        </g>
      </g>
      <rect x="0" y="0" width="220" height="330" fill="none" stroke="black" stroke-width="1" />
      <animateTransform
        xlink:href="#bar2"
        attributeName="transform"
        attributeType="XML"
        type="translate"
        from="90 21"
        to="44 60"
        dur="2s"
        begin="0s" />
    </svg>
    <script>
      function buildEl(name, attrs, id) {
        var el = document.createElementNS("http://www.w3.org/2000/svg", name);
        for (var key in attrs) {
          el.setAttribute(key, attrs[key]);
        }

        if (id !== undefined) el.setAttribute('id', id);

        return el;
      }

      function getDecadeForYr(yr) {
        return Math.floor(yr / 10);
      }

      var curYr = new Date().getFullYear();
      var curDecade = getDecadeForYr(curYr);

      function buildDecadeEl(decadeYr) {
        var decadeHeight = 30;  // TODO: Define as constant
        var decadeWidth = 60;

        var decade = getDecadeForYr(decadeYr)

        var y = (curDecade - decade) * decadeHeight;

        var decadeAttrs = {
          'transform': 'translate(0, ' + y + ')'
        };
        var decadeEl = buildEl('g', decadeAttrs, 'decade' + decadeYr);

        var rectAttrs = {
          'x': 0, 'y': 0,
          'width': decadeWidth, 'height': decadeHeight,
          'style': "stroke:lightgray;fill:none;stroke-width:1"
        };
        var rectEl = buildEl('rect', rectAttrs);
        decadeEl.appendChild(rectEl);

        var textAttrs = {
          'x': decadeWidth / 2, 'y': decadeHeight / 2,
          'text-anchor': 'middle', 'alignment-baseline': 'central'
        }
        var textEl = buildEl('text', textAttrs);
        textEl.innerHTML = decadeYr;
        decadeEl.appendChild(textEl);

        return decadeEl;
      }

      function addDecadeEls(startYr) {
        var startDecade = getDecadeForYr(startYr);

        var decadesEl = document.getElementById("decades");
        for (var decade = startDecade; decade <= curDecade; decade++) {
          var decadeEl = buildDecadeEl(decade * 10);

          decadesEl.appendChild(decadeEl);
        }
      }

      function buildFigureEl(id, name, height, color, x, y) {
        var width = 30; // TODO: define as constant

        var figureAttrs = {};
        if (x !== undefined && y !== undefined) {
          figureAttrs['transform'] = "translate(" + x + ", " + y + ")";
        }
        var figureEl = buildEl('g', figureAttrs, id);

        var halfWidth = width / 2;
        var halfHeight = height / 2;
        var groupingTransforms = [
          "translate(" + halfWidth + ", " + -halfHeight + ")",
          "rotate(90)",
          "translate(" + halfHeight + ", " + -halfWidth + ")"
        ];

        var groupingEl = buildEl('g', {'transform': groupingTransforms.join(" ")});
        figureEl.appendChild(groupingEl);

        var rectAttrs = {
          'x': 0, 'y': 0,
          'width': height, 'height': width, // Yes, this looks backwards, but that's because the rotate(90) transform is being applied
          'style': "stroke:black;fill:" + color + ";stroke-width:1"
        };
        var rectEl = buildEl('rect', rectAttrs);
        groupingEl.appendChild(rectEl);

        var textAttrs = {
          'x': halfHeight, 'y': halfWidth, // Yes, this looks backwards, but that's because the rotate(90) transform is being applied
          'text-anchor': "middle", 'alignment-baseline': "central"
        };
        var textEl = buildEl('text', textAttrs);
        textEl.innerHTML = name;
        groupingEl.appendChild(textEl);

        return figureEl;
      }

      var figureEl = buildFigureEl('frankId', 'Frank Longbottom', 200, 'green');
      var figuresEl = document.getElementById("figures");
      figuresEl.appendChild(figureEl);

      addDecadeEls(1924);
    </script>
  </body>
</html>
